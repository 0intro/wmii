#!9PREFIX/bin/rc
# window manager improved 2 wrapper

if(! ~ $#* 0) {
    exec wmiiwm $*
}

if(! wmiiwm -c) {
    exit 1  # wmiiwm is already running or $DISPLAY is unset
}

WMII_CONFDIR=CONFPREFIX/wmii-3
OLD_PATH=$PATH
PATH=$HOME/.wmii-3:$WMII_CONFDIR:9PREFIX/bin:$PATH
WMII_IDENT=`{date -n}^'-'^$pid
WMII_ADDRESS=unix!/tmp/.ixp-$USER/wmiifs-$WMII_IDENT

# start window manager and utilities:
mkdir -p /tmp/.ixp-$USER
wmiifs -a $WMII_ADDRESS &
wmiifspid=$apid
wmiiwm -a unix!/tmp/.ixp-$USER/wmiiwm-$WMII_IDENT &
wmiikeys -a unix!/tmp/.ixp-$USER/wmiikeys-$WMII_IDENT &
wmiibar -a unix!/tmp/.ixp-$USER/wmiibar-$WMII_IDENT &
#wmiimenu -a /tmp/.ixp-$USER/wmiimenu-$WMII_IDENT &
sleep 1

# mount ixp file systems:
echo -n mount unix!/tmp/.ixp-$USER/wmiiwm-$WMII_IDENT /wm | wmiir write /ctl
echo -n mount unix!/tmp/.ixp-$USER/wmiibar-$WMII_IDENT /bar | wmiir write /ctl
echo -n mount unix!/tmp/.ixp-$USER/wmiikeys-$WMII_IDENT /keys | wmiir write /ctl

# display the wmii introduction if necessary:
if(mkdir $HOME/.wmii-3 >[2]/dev/null) {
    welcome &
}

# run configuration:
wmiirc &

# wait for wmiifs's termination:
wait $wmiifspid
